import{jsx as s,Fragment as Z,jsxs as w}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as b,useEffect as x,useMemo as _,useState as V,createContext as H,useContext as z}from"@dropins/tools/preact-compat.js";import{s as K,a as Q,b as W}from"../chunks/searchProducts.js";import"@dropins/tools/lib.js";import{g as U,c as I}from"../chunks/currency-symbol-map.js";/* empty css             */import"@dropins/tools/fetch-graphql.js";function G(){return s("svg",{width:"60",height:"74",viewBox:"0 0 60 74",children:s("path",{d:"M26,85H70a8.009,8.009,0,0,0,8-8V29.941a7.947,7.947,0,0,0-2.343-5.657L64.716,13.343A7.946,7.946,0,0,0,59.059,11H26a8.009,8.009,0,0,0-8,8V77a8.009,8.009,0,0,0,8,8ZM20,19a6.007,6.007,0,0,1,6-6H59.059A5.96,5.96,0,0,1,63.3,14.757L74.242,25.7A5.96,5.96,0,0,1,76,29.941V77a6.007,6.007,0,0,1-6,6H26a6.007,6.007,0,0,1-6-6Zm6.614,51.06h0L68,69.98a.75.75,0,0,0,.545-1.263L57.67,57.129a1.99,1.99,0,0,0-2.808-.028L51.6,60.467l-.024.026-7.087-7.543a1.73,1.73,0,0,0-1.229-.535,1.765,1.765,0,0,0-1.249.5L26.084,68.778a.75.75,0,0,0,.529,1.281Zm26.061-8.548,3.252-3.354a.333.333,0,0,1,.332-.123.463.463,0,0,1,.324.126L66.27,68.484l-7.177.014-6.5-6.916a.735.735,0,0,0,.078-.071Zm-9.611-7.526a.235.235,0,0,1,.168-.069.212.212,0,0,1,.168.068L57.039,68.5l-28.606.055Zm20.05-.43h.079a5.087,5.087,0,0,0,3.583-1.47,5.146,5.146,0,1,0-7.279-.109,5.089,5.089,0,0,0,3.617,1.579Zm-2.456-7.839a3.6,3.6,0,0,1,2.534-1.042h.056a3.7,3.7,0,0,1,2.478,6.34,3.51,3.51,0,0,1-2.589,1.041,3.6,3.6,0,0,1-2.557-1.118,3.715,3.715,0,0,1,.079-5.221Z",transform:"translate(-18 -11)",fill:"#8e8e8e"})})}function R(e){var n,r,t="";if(typeof e=="string"||typeof e=="number")t+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(n=0;n<i;n++)e[n]&&(r=R(e[n]))&&(t&&(t+=" "),t+=r)}else for(r in e)e[r]&&(t&&(t+=" "),t+=r);return t}function q(){for(var e,n,r=0,t="",i=arguments.length;r<i;r++)(e=arguments[r])&&(n=R(e))&&(t&&(t+=" "),t+=n);return t}const X=({className:e,...n})=>{const{products:r}=P();return r.length?s("button",{...n,type:"submit",className:q(["search-popover-view-all",e]),children:"View All"}):s(Z,{})};function J(){const{products:e,route:n}=P();return w("div",{className:"grid grid-cols-1 gap-4",children:[e.map(r=>w("div",{className:"relative flex items-center px-6 py-5 space-x-3 bg-white border border-gray-300 rounded-lg shadow-sm focus-within:ring-2 focus-within:ring-indigo-500 focus-within:ring-offset-2 hover:border-gray-400",children:[s("div",{className:"flex-shrink-0",children:s(Y,{product:r})}),s("div",{className:"flex-1 min-w-0",children:w("a",{href:n==null?void 0:n({sku:r.sku,urlKey:r.urlKey??""}),className:"focus:outline-none",children:[s("span",{"aria-hidden":"true",className:"inset-0"}),s("p",{className:"font-medium text-gray-900",children:r.name}),s("p",{className:"mt-4 text-gray-500 no-underline",children:r.price})]})})]},r.uid)),s(X,{})]})}function Y({product:e}){return e.image?s("img",{alt:"",src:e.image,className:"h-56"}):s(G,{})}var D="Expected a function",k=NaN,ee="[object Symbol]",ne=/^\s+|\s+$/g,re=/^[-+]0x[0-9a-f]+$/i,te=/^0b[01]+$/i,oe=/^0o[0-7]+$/i,ie=parseInt,ce=typeof I=="object"&&I&&I.Object===Object&&I,ae=typeof self=="object"&&self&&self.Object===Object&&self,se=ce||ae||Function("return this")(),ue=Object.prototype,fe=ue.toString,de=Math.max,le=Math.min,E=function(){return se.Date.now()};function me(e,n,r){var t,i,u,a,o,f,d=0,h=!1,g=!1,y=!0;if(typeof e!="function")throw new TypeError(D);n=A(n)||0,L(r)&&(h=!!r.leading,g="maxWait"in r,u=g?de(A(r.maxWait)||0,n):u,y="trailing"in r?!!r.trailing:y);function l(c){var p=t,v=i;return t=i=void 0,d=c,a=e.apply(v,p),a}function m(c){return d=c,o=setTimeout(S,n),h?l(c):a}function C(c){var p=c-f,v=c-d,O=n-p;return g?le(O,u-v):O}function T(c){var p=c-f,v=c-d;return f===void 0||p>=n||p<0||g&&v>=u}function S(){var c=E();if(T(c))return N(c);o=setTimeout(S,C(c))}function N(c){return o=void 0,y&&t?l(c):(t=i=void 0,a)}function $(){o!==void 0&&clearTimeout(o),d=0,t=f=i=o=void 0}function B(){return o===void 0?a:N(E())}function j(){var c=E(),p=T(c);if(t=arguments,i=this,f=c,p){if(o===void 0)return m(f);if(g)return o=setTimeout(S,n),l(f)}return o===void 0&&(o=setTimeout(S,n)),a}return j.cancel=$,j.flush=B,j}function L(e){var n=typeof e;return!!e&&(n=="object"||n=="function")}function ge(e){return!!e&&typeof e=="object"}function pe(e){return typeof e=="symbol"||ge(e)&&fe.call(e)==ee}function A(e){if(typeof e=="number")return e;if(pe(e))return k;if(L(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=L(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=e.replace(ne,"");var r=te.test(e);return r||oe.test(e)?ie(e.slice(2),r?2:8):re.test(e)?k:+e}var he=me;const M=U(he);function be(e){const n=b(e);n.current=e,x(()=>()=>{n.current()},[])}function ye(e,n=500,r){const t=b();be(()=>{t.current&&t.current.cancel()});const i=_(()=>{const u=M(e,n,r),a=(...o)=>u(...o);return a.cancel=()=>{u.cancel()},a.isPending=()=>!!t.current,a.flush=()=>u.flush(),a},[e,n,r]);return x(()=>{t.current=M(e,n,r)},[e,n,r]),i}function ve(e,n,r){const t=(d,h)=>d===h,i=e instanceof Function?e():e,[u,a]=V(i),o=b(i),f=ye(a,n,r);return t(o.current,i)||(f(i),o.current=i),[u,f]}const xe={products:[],config:{pageSize:8,perPageConfig:{pageSizeOptions:"12,24,36",defaultPageSizeOption:"24"},minQueryLength:"2",currencySymbol:"$",currencyRate:"1",displayOutOfStock:!0,allowAllProducts:!1},route:({sku:e,urlKey:n})=>`/products/${n}/${e}`},F=H(xe),Pe=({children:e,storefrontDetails:n})=>{const{config:r,route:t}=n;x(()=>{K(n.apiUrl),Q({"Magento-Environment-Id":n.environmentId,"Magento-Website-Code":n.websiteCode,"Magento-Store-Code":n.storeCode,"Magento-Store-View-Code":n.storeViewCode,"X-Api-Key":n.apiKey})},[n.apiKey,n.apiUrl,n.environmentId,n.storeCode,n.storeViewCode,n.websiteCode]);const i=b(null),u=b(null),a=b(null),[o,f]=ve("",500),[d,h]=V([]),g=l=>{f(l.currentTarget.value)};x(()=>{const l=document.getElementById("search_mini_form"),m=document.getElementById("search"),C=document.getElementById("search_autocomplete");return i.current=l,u.current=m,a.current=C,m==null||m.addEventListener("input",g),()=>{m==null||m.removeEventListener("input",g)}},[]),x(()=>{(async()=>{if(o.length>+r.minQueryLength){const l=await W(o,r.pageSize);h(l??[])}})()},[o,r.minQueryLength,r.pageSize]);const y={products:d,config:r,route:t};return s(F.Provider,{value:y,children:s(J,{})})},P=()=>{const e=z(F);if(e===null){const n=new Error("Missing <PopoverProvider /> component.");throw Error.captureStackTrace&&Error.captureStackTrace(n,P),n}return e};export{F as PopoverContext,Pe as SearchPopover,Pe as default,P as usePopover};
