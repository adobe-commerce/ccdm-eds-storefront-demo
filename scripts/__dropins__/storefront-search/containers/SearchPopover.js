/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as d,Fragment as W,jsxs as O}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as v,useEffect as T,useMemo as G,useState as M,useReducer as J,createContext as Y,useContext as ee}from"@dropins/tools/preact-compat.js";import{s as b,g as te,c as L,a as ne}from"../chunks/searchProducts.js";import{events as re}from"@dropins/tools/event-bus.js";import"@dropins/tools/fetch-graphql.js";const N={SEARCH_INPUT_CONTEXT:"searchInputContext",SEARCH_RESULTS_CONTEXT:"searchResultsContext"},I={SEARCH_PRODUCT_CLICK:"search-product-click",SEARCH_SUGGESTION_CLICK:"search-suggestion-click",SEARCH_REQUEST_SENT:"search-request-sent",SEARCH_RESPONSE_RECEIVED:"search-response-received",SEARCH_RESULTS_VIEW:"search-results-view"},A=()=>(window.adobeDataLayer=window.adobeDataLayer||[],window.adobeDataLayer);function X(e,t){A().push({[e]:t})}function x(e,t){A().push(r=>{var s;const o=((s=r.getState)==null?void 0:s.call(r))??{};r.push({event:e,eventInfo:{...o,...t}})})}const oe=()=>({publishSearchProductClick:s=>{x(I.SEARCH_PRODUCT_CLICK,{searchUnitId:b,sku:s})},updateSearchInputContext:()=>{},searchRequestSent:()=>{},searchResponseReceived:()=>{},searchResultsView:()=>{}});function z(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=z(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function B(){for(var e,t,n=0,r="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=z(e))&&(r&&(r+=" "),r+=t);return r}function se(){return d("svg",{width:"60",height:"74",viewBox:"0 0 60 74",children:d("path",{d:"M26,85H70a8.009,8.009,0,0,0,8-8V29.941a7.947,7.947,0,0,0-2.343-5.657L64.716,13.343A7.946,7.946,0,0,0,59.059,11H26a8.009,8.009,0,0,0-8,8V77a8.009,8.009,0,0,0,8,8ZM20,19a6.007,6.007,0,0,1,6-6H59.059A5.96,5.96,0,0,1,63.3,14.757L74.242,25.7A5.96,5.96,0,0,1,76,29.941V77a6.007,6.007,0,0,1-6,6H26a6.007,6.007,0,0,1-6-6Zm6.614,51.06h0L68,69.98a.75.75,0,0,0,.545-1.263L57.67,57.129a1.99,1.99,0,0,0-2.808-.028L51.6,60.467l-.024.026-7.087-7.543a1.73,1.73,0,0,0-1.229-.535,1.765,1.765,0,0,0-1.249.5L26.084,68.778a.75.75,0,0,0,.529,1.281Zm26.061-8.548,3.252-3.354a.333.333,0,0,1,.332-.123.463.463,0,0,1,.324.126L66.27,68.484l-7.177.014-6.5-6.916a.735.735,0,0,0,.078-.071Zm-9.611-7.526a.235.235,0,0,1,.168-.069.212.212,0,0,1,.168.068L57.039,68.5l-28.606.055Zm20.05-.43h.079a5.087,5.087,0,0,0,3.583-1.47,5.146,5.146,0,1,0-7.279-.109,5.089,5.089,0,0,0,3.617,1.579Zm-2.456-7.839a3.6,3.6,0,0,1,2.534-1.042h.056a3.7,3.7,0,0,1,2.478,6.34,3.51,3.51,0,0,1-2.589,1.041,3.6,3.6,0,0,1-2.557-1.118,3.715,3.715,0,0,1,.079-5.221Z",transform:"translate(-18 -11)",fill:"#8e8e8e"})})}const ce=({className:e,...t})=>{const{products:n}=D();return n.length?d("button",{...t,type:"submit",className:B(["search-popover-view-all",e]),children:"View All"}):d(W,{})};function ae(){const{products:e,route:t}=D(),{publishSearchProductClick:n}=oe(),r=(o,s)=>{o.preventDefault();const c=o.currentTarget;n(s.sku),x(I.SEARCH_PRODUCT_CLICK),window.location.href=c.href};return O("div",{className:B("search-popover-root","grid grid-cols-1 gap-4 mt-1"),children:[e.map(o=>O("div",{className:"relative flex items-center px-6 py-5 space-x-3 bg-white border border-gray-300 rounded-lg shadow-sm focus-within:ring-2 focus-within:ring-indigo-500 focus-within:ring-offset-2 hover:border-gray-400",children:[d("div",{className:"flex-shrink-0",children:d(ie,{product:o})}),d("div",{className:"flex-1 min-w-0",children:O("a",{href:t==null?void 0:t({sku:o.sku,urlKey:o.urlKey??""}),onClick:s=>r(s,o),className:"focus:outline-none",children:[d("span",{"aria-hidden":"true",className:"inset-0"}),d("p",{className:"font-medium text-gray-900",children:o.name}),d("p",{className:"mt-4 text-gray-500 no-underline",children:`$${o.price}`})]})})]},o.uid)),d(ce,{})]})}function ie({product:e}){return e.image?d("img",{alt:"",src:e.image,className:"h-56"}):d(se,{})}var ue="Expected a function",$=NaN,fe="[object Symbol]",de=/^\s+|\s+$/g,le=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,he=/^0o[0-7]+$/i,me=parseInt,ge=typeof L=="object"&&L&&L.Object===Object&&L,Se=typeof self=="object"&&self&&self.Object===Object&&self,ye=ge||Se||Function("return this")(),Ee=Object.prototype,be=Ee.toString,ve=Math.max,Ce=Math.min,k=function(){return ye.Date.now()};function Re(e,t,n){var r,o,s,c,i,a,p=0,m=!1,S=!1,y=!0;if(typeof e!="function")throw new TypeError(ue);t=F(t)||0,H(n)&&(m=!!n.leading,S="maxWait"in n,s=S?ve(F(n.maxWait)||0,t):s,y="trailing"in n?!!n.trailing:y);function C(u){var g=r,R=o;return r=o=void 0,p=u,c=e.apply(R,g),c}function l(u){return p=u,i=setTimeout(_,t),m?C(u):c}function h(u){var g=u-a,R=u-p,j=t-g;return S?Ce(j,s-R):j}function E(u){var g=u-a,R=u-p;return a===void 0||g>=t||g<0||S&&R>=s}function _(){var u=k();if(E(u))return V(u);i=setTimeout(_,h(u))}function V(u){return i=void 0,y&&r?C(u):(r=o=void 0,c)}function Z(){i!==void 0&&clearTimeout(i),p=0,r=a=o=i=void 0}function Q(){return i===void 0?c:V(k())}function P(){var u=k(),g=E(u);if(r=arguments,o=this,a=u,g){if(i===void 0)return l(a);if(S)return i=setTimeout(_,t),C(a)}return i===void 0&&(i=setTimeout(_,t)),c}return P.cancel=Z,P.flush=Q,P}function H(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Te(e){return!!e&&typeof e=="object"}function Ie(e){return typeof e=="symbol"||Te(e)&&be.call(e)==fe}function F(e){if(typeof e=="number")return e;if(Ie(e))return $;if(H(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=H(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(de,"");var n=pe.test(e);return n||he.test(e)?me(e.slice(2),n?2:8):le.test(e)?$:+e}var xe=Re;const q=te(xe);function _e(e){const t=v(e);t.current=e,T(()=>()=>{t.current()},[])}function Le(e,t=500,n){const r=v();_e(()=>{r.current&&r.current.cancel()});const o=G(()=>{const s=q(e,t,n),c=(...i)=>s(...i);return c.cancel=()=>{s.cancel()},c.isPending=()=>!!r.current,c.flush=()=>s.flush(),c},[e,t,n]);return T(()=>{r.current=q(e,t,n)},[e,t,n]),o}function we(e,t,n){const r=(p,m)=>p===m,o=e instanceof Function?e():e,[s,c]=M(o),i=v(o),a=Le(c,t,n);return r(i.current,o)||(a(o),i.current=o),[s,a]}var w,Ne=new Uint8Array(16);function Ae(){if(!w&&(w=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!w))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return w(Ne)}const Pe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Oe(e){return typeof e=="string"&&Pe.test(e)}var f=[];for(var U=0;U<256;++U)f.push((U+256).toString(16).substr(1));function ke(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase();if(!Oe(n))throw TypeError("Stringified UUID is invalid");return n}function Ue(e,t,n){e=e||{};var r=e.random||(e.rng||Ae)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ke(r)}const He=(e,t,n,r,o)=>{var p;const c=A().getState(N.SEARCH_INPUT_CONTEXT)??{units:[]},i={searchUnitId:e,searchRequestId:t,queryTypes:["products","suggestions"],phrase:n,pageSize:o,currentPage:1,filter:r,sort:[]},a=(p=c.units)==null?void 0:p.findIndex(m=>(m==null?void 0:m.searchUnitId)===e);a===void 0||a<0?c.units.push(i):c.units[a]=i,X(N.SEARCH_INPUT_CONTEXT,c)},De=(e,t,n)=>{var i;const o=A().getState(N.SEARCH_RESULTS_CONTEXT)??{units:[]},s=(i=o==null?void 0:o.units)==null?void 0:i.findIndex(a=>(a==null?void 0:a.searchUnitId)===e),c={searchUnitId:e,searchRequestId:t,products:(n==null?void 0:n.products.map(a=>({...a,price:Number(a.price)})))??[],categories:[],suggestions:[],page:(n==null?void 0:n.pageInfo.current)||1,perPage:(n==null?void 0:n.pageInfo.size)||6,facets:[]};s===void 0||s<0?o.units.push(c):o.units[s]=c,X(N.SEARCH_RESULTS_CONTEXT,o)},Ve={filters:[{attribute:"visibility",in:["Search","Catalog, Search"]},{attribute:"inStock",eq:"false"}],sort:[]};function je(e,t){switch(t.type){case"SET_IN_STOCK_FILTER":return{...e,filters:e.filters.map(n=>(n.attribute==="inStock"&&(n.eq=`${t.value.toString()}`),n))};default:throw Error(`Unknown action: ${t.type}`)}}const $e=e=>{const[t,n]=J(je,Ve);return{search:async o=>{const s=Ue();He(b,s,o,t.filters,e.pageSize),x(I.SEARCH_REQUEST_SENT,{searchUnitId:b});const c=await ne(o,e.pageSize);return De(b,s,c),x(I.SEARCH_RESPONSE_RECEIVED,{searchUnitId:b}),x(I.SEARCH_RESULTS_VIEW,{searchUnitId:b}),c}}};console.log("thingy thingy thingy");const Fe={products:[],config:{pageSize:8,perPageConfig:{pageSizeOptions:"12,24,36",defaultPageSizeOption:"24"},minQueryLength:"2",currencySymbol:"$",currencyRate:"1",displayOutOfStock:!0,allowAllProducts:!1},route:({sku:e,urlKey:t})=>`/products/${t}/${e}`},K=Y(Fe),Ke=({children:e,storefrontDetails:t})=>{const{config:n,route:r}=t,{search:o}=$e(n),s=v(null),c=v(null),i=v(null),[a,p]=we("",500),[m,S]=M([]),y=l=>{p(l.currentTarget.value)};T(()=>{const l=document.getElementById("search_mini_form"),h=document.getElementById("search"),E=document.getElementById("search_autocomplete");return s.current=l,c.current=h,i.current=E,h==null||h.addEventListener("input",y),()=>{h==null||h.removeEventListener("input",y)}},[]),T(()=>{(async()=>{if(a.length>+n.minQueryLength){const l=await o(a);S((l==null?void 0:l.products)??[])}})()},[a,n.minQueryLength,n.pageSize]),T(()=>{const l=re.on("search/event",({type:h,payload:E})=>{console.log(`from dropin: ${{type:h,payload:E}}`)});return()=>{l==null||l.off()}},[]);const C={products:m,config:n,route:r};return d(K.Provider,{value:C,children:d(ae,{})})},D=()=>{const e=ee(K);if(e===null){const t=new Error("Missing <PopoverProvider /> component.");throw Error.captureStackTrace&&Error.captureStackTrace(t,D),t}return e};export{K as PopoverContext,Ke as SearchPopover,Ke as default,D as usePopover};
